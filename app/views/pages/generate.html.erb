<div class="container">
  <div class="row justify-content-center">
    <div class="col-sm-8 my-3" data-controller='searchbar' data-action="keyup->searchbar#search">
      <div data-searchbar-target="input">
        <%= form_with url: generate_path, method: :get, class: "d-flex" do %>
          <%= text_field_tag :query,
                params[:query],
                class: "form-control",
                placeholder: "Type a keyword"
            %>
          <%= submit_tag "Search", name: "", class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>

    <% if @grouped_pieces.any? %>
      <% @grouped_pieces.each do |category, pieces| %>
        <div data-controller="pieces">
          <div data-pieces-target="category"
               data-action="click->pieces#toggleList"
               class='p-3 m-2 d-flex justify-content-between align-items-center'
               style='border-radius: 10px;background-color:white;'>
            <span style='font-size: 26px;'><strong><%= category.name %></strong> (<%= pieces.count %>)</span>
            <img src='http://res.cloudinary.com/dcequpnjy/image/upload/v1/development/h1hojxs3yr2c14n2jtqdzb6rh4zp'
                  style='height: 100px;'>
          </div>

          <div data-pieces-target="list"
               class="d-none position-absolute"
               style="background-color:#F4F4F4;min-height:calc(100vh - 58px);width:0;top:0;right:0;left:0;">
            <span style='font-size: 26px;'>
              <i class="fa-solid fa-arrow-left" data-action="click->pieces#toggleList"></i>
              <strong><%= category.name %></strong>
            </span>
            <div class="pieces-list">
              <% pieces.each do |piece| %>
                <div class="pieces-list-item-no-shadow justify-content-center"
                    style="border-radius: 5px;text-align: center;">
                  <label for="piece<%= piece.id %>">
                    <%= cl_image_tag piece.photo.key %>
                    <h6><%= piece.name %></h6>
                  </label>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <em> Sorry, no pieces found. </em>
    <% end %>
  </div>
</div>
